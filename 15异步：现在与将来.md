# 异步：现在与将来

### 分块的程序

可以将`javascript`程序写在单个`.js`文件中，但是这个程序机会一定是由多个块构成的。这些块中只有一个是现在执行的，其余的则是会在将来执行。最常见的块单位就是函数。

任何时候，只要把一段代码包装成一个函数，并指定他在响应某个事件（定时器、鼠标点击、`Ajax`响应等）时执行，你就是在代码中创建了一个将来执行的块，也由此在这个程序中引入了异步机制。

#### 异步控制台

有时候我们在控制台打印东西，可能不是我们预想的结果，如下代码：

```js
var a = {
  index: 1
}
// 然后
console.log(a)
// 在然后
a.index++
```

我们会以为输出的是 1，但是这段代码在运行的时候，浏览器可能会认为需要把控制台`I/O`延迟到后台，在这种情况下，等到浏览器控制台输出对象内容时候，`a.index++`可能已经指向，因此会显示`{index: 2}`。

> 我们如果遇到这种情况，可以使用`javscript`调试器中的断点，而不要依赖控制台输出。次优方案是把对象序列化到一个字符串中，以强制执行一次“快照”，比如通过`JSON.stringify(...)`。
